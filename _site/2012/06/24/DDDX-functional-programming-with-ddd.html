<!DOCTYPE html>
<html lang="en">
  	<head>
    	<meta charset="utf-8"> 
    	<meta name="viewport" content="width=device-width, initial-scale=1">
	    <link rel="stylesheet" href="/assets/stylesheets/bootstrap.min.css">
	  	<link rel="stylesheet" href="/assets/stylesheets/styles.css">
	  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	  	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	    <link href="/assets/stylesheets/syntaxhighlighter/shCore.css" type="text/css" rel="stylesheet"/>
	    <link href="/assets/stylesheets/syntaxhighlighter/shThemeDefault.css" rel="stylesheet" type="text/css" />
		<link href="/assets/stylesheets/twitter.css" type="text/css" rel="stylesheet"/>
	    <title>Ninja Ferret : DDD eXchange - Functional DDD - Greg Young </title>
  	</head>
  	<body>
	  	<nav role="navigation" class="navbar navbar-default">
		    <div class="navbar-header">
		        <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
		            <span class="sr-only">Toggle navigation</span>
		            <span class="icon-bar"></span>
		            <span class="icon-bar"></span>
		            <span class="icon-bar"></span>
		        </button>
		        <a href="#" class="navbar-brand">Ninja Ferret</a>
		    </div>
		    <div id="navbarCollapse" class="collapse navbar-collapse">
		        <ul class="nav navbar-nav">
		            <li><a href="http://ninjaferret.co.uk">Home</a></li>
		            <li class="active"><a href="http://blog.ninjaferret.co.uk">Blog</a></li>
		            <li><a href="http://ninjaferret.co.uk/about.aspx">About</a></li>
		        </ul>
		    </div>
		</nav>
		<div class="container-fluid">
	  		<div class="row-fluid">
				<h1 class="center-block"><a href="http://ninjaferret.github.com"><img class="center-block img-responsive" src="/assets/images/Logo-White.jpg" alt="Ninja Ferret" title="Ninja Ferret" /></a></h1>
			</div>
			<div class="row-fluid">
				<div class="sub-heading">The random thoughts of a software developer</h2>
			</div>
		<!--<div id="side_bar">
			<div id="atom">
				<h3>Feeds</h3>
				<a href="/feed.atom"><img src="http://www.mozilla.org/images/feed-icon-14x14.png" alt="Atom feed"/></a> To keep updated <a href="/feed.atom">subscribe to this atom feed</a>.
			</div>
			<div id="tags">
				<h3>Tags</h3>
				<ul>
				
				  	<li><a href="/tags.html#.net">.net</a> (10)</li>
				
				  	<li><a href="/tags.html#c#">c#</a> (10)</li>
				
				  	<li><a href="/tags.html#reflection">reflection</a> (5)</li>
				
				  	<li><a href="/tags.html#conferences">conferences</a> (7)</li>
				
				  	<li><a href="/tags.html#ddd8">ddd8</a> (1)</li>
				
				  	<li><a href="/tags.html#wcf">wcf</a> (3)</li>
				
				  	<li><a href="/tags.html#development methodologies">development methodologies</a> (2)</li>
				
				  	<li><a href="/tags.html#kanban">kanban</a> (1)</li>
				
				  	<li><a href="/tags.html#uk tech days">uk tech days</a> (1)</li>
				
				  	<li><a href="/tags.html#architecture">architecture</a> (5)</li>
				
				  	<li><a href="/tags.html#software architecture">software architecture</a> (3)</li>
				
				  	<li><a href="/tags.html#cqrs">cqrs</a> (1)</li>
				
				  	<li><a href="/tags.html#conference">conference</a> (1)</li>
				
				  	<li><a href="/tags.html#ddd">ddd</a> (1)</li>
				
				  	<li><a href="/tags.html#developerdeveloperdeveloper">developerdeveloperdeveloper</a> (2)</li>
				
				  	<li><a href="/tags.html#platform">platform</a> (1)</li>
				
				  	<li><a href="/tags.html#registration">registration</a> (1)</li>
				
				  	<li><a href="/tags.html#windows phone 7">windows phone 7</a> (1)</li>
				
				  	<li><a href="/tags.html#domain events">domain events</a> (1)</li>
				
				  	<li><a href="/tags.html#bar camp">bar camp</a> (1)</li>
				
				  	<li><a href="/tags.html#barcamp">barcamp</a> (1)</li>
				
				  	<li><a href="/tags.html#bdd">bdd</a> (1)</li>
				
				  	<li><a href="/tags.html#lean">lean</a> (2)</li>
				
				  	<li><a href="/tags.html#blogging">blogging</a> (4)</li>
				
				  	<li><a href="/tags.html#github">github</a> (4)</li>
				
				  	<li><a href="/tags.html#twitter">twitter</a> (1)</li>
				
				  	<li><a href="/tags.html#git">git</a> (1)</li>
				
				  	<li><a href="/tags.html#jekyll">jekyll</a> (1)</li>
				
				  	<li><a href="/tags.html#tags">tags</a> (1)</li>
				
				  	<li><a href="/tags.html#agile">agile</a> (1)</li>
				
				  	<li><a href="/tags.html#project management">project management</a> (1)</li>
				
				  	<li><a href="/tags.html#msbuild">msbuild</a> (1)</li>
				
				  	<li><a href="/tags.html#creativity">creativity</a> (4)</li>
				
				  	<li><a href="/tags.html#dddx">dddx</a> (2)</li>
				
				  	<li><a href="/tags.html#2012">2012</a> (2)</li>
				
				  	<li><a href="/tags.html#software craftsmanship">software craftsmanship</a> (1)</li>
				
				  	<li><a href="/tags.html#change">change</a> (2)</li>
				
				  	<li><a href="/tags.html#disruptive change">disruptive change</a> (1)</li>
				
			</div>
	  		<div id="twitter">
				<h3>Twitter</h3>
				<p><a href="http://twitter.com/ijohnson_tnf"><img src="http://twitter.zendesk.com/attachments/token/yttm4jflos7vnyq/?name=t_mini-a.png" alt="Follow me on twitter" /></a> Follow <a href="http://twitter.com/ijohnson_tnf">@IJohnson_TNF</a> on Twitter</p>
	 			<ul id="twitter_update_list"></ul>
	  		</div>

		</div>-->
			<div class="wrapper">
				<div class="container">
					
					<h2>DDD eXchange - Functional DDD - Greg Young</h2>
					

					<p>
	Greg Young was the first speaker at <a href="http://skillsmatter.com">Skillsmatter's</a> DDD eXchange and was talking to 
	us about how functional programming and <em>Domain Driven Design</em> can work together peacefully.
</p>
<p>
	The origins of <em>DDD</em> lay firmly in the Object Oriented world. The <em>Domain Models</em> in our code are linked
	directly to the <em>Ubiquitous Language</em>, the code and the language we use to describe the domain are as one. Therefore
	in the object world the objects are the nouns and the methods are the verbs. So how does this work in a functional context where there
	are only functions? I think that there are still a few issues that Greg has not fully answered in this but I'm hoping to play with the ideas
	in the future to really understand my own doubts
</p>
<h3>
	Refactoring the Domain
</h3>
<p>
	So, assuming that we have an domain around eCommerce we may well have the concept of a <strong>InventoryItem</strong>
	which is something you can sell. Assume someone wants to deactivate the item:
</p>
<code>
	<pre class="brush: csharp">
	public class InventoryItem
	{
		...
		public void Deactivate(string reason)
		{
			if (!_active) throw new AlreadyDeactivatedException(_id);
			_active = false;
		}
		...
	}
	</pre>
</code>
<p>
	At the moment that this is not even <em>event sourced</em>, but we also want to think about splitting apart the logic that decides whether
	the state change can occur from the actual state change.
</p>
<code>
	<pre class="brush: csharp">
	public class InventoryItem
	{
		...
		public void Deactivate(string reason)
		{
			if (!_active) throw new AlreadyDeactivatedException(_id);
			DoDeactivate(reason);
		}
		
		private void DoDeactivate(string reason)
		{
			_active = false;
		}
		...
	}
	</pre>
</code>
<h3>
	Making it Event Sourced
</h3>
<p>
	It is easy to make things <em>Event Sourced</em>  from this position, we refactor further to extract out the parameters
	of the method into a class that represents the state change:
</p>
<code>
	<pre class="brush: csharp">
	public class InventoryItem
	{
		...
		public void Deactivate(string reason)
		{
			if (!_active) throw new AlreadyDeactivatedException(_id);
			DoDeactivate(new InventoryItemDeactivated(_id, reason));
		}
		
		private void DoDeactivate(InventoryItemDeactivated event)
		{
			_active = false;
		}
		...
	}
	
	public class InventoryItemDeactivated : Event
	{
		public InventoryItemDeactivated(string reason)
		{
			...
		}
	}
	</pre>
</code>
<p>
	When we have separated the code out in this  manner we can re-build the state of the object by applying methods in sequence:
<p>
<code>
	<pre class="brush: csharp">
	var item = new InventoryItem();
	item.Created(...);
	item.PriceUpdated(...);
	item.Deactivated(...);
	</pre>
</code>
<p>
	Also, we are now independent of any logic that may be imposed, any calculations. We are simply involved in state change
	but what that state change means can vary over time.
</p>
<h3>
	Event Sourcing is Functional
</h3>
<p>
	Greg argues that when you have made your model <em>Event Sourced</em> then the <em>Events</em> are 
	representations of method calls, they are the serialized function calls of the <strong>DoXXX</strong> methods that change state
	not the public methods that decide whether or not to allow the state the change. 
</p>
<p>
	Let's make another change or two, assume that the <strong>InventoryItem</strong> is an immutable...
</p>
<code>
	<pre class="brush: csharp">
	public class InventoryItem
	{
		...
		public void Deactivate(string reason)
		{
			if (!_active) throw new AlreadyDeactivatedException(_id);
			DoDeactivate(new InventoryItemDeactivated(_id, reason));
		}
		
		public InventoryItem DoDeactivate(InventoryItemDeactivated event)
		{
			return new InventoryItem(this, false);
		}
		...
	}
	
	public class InventoryItemDeactivated : Event
	{
		public InventoryItemDeactivated(string reason)
		{
			...
		}
	}
	</pre>
</code>
<p>
	One advantage of this is that now we can re-build the state of the object at any time by chaining together method calls...
</p>
<code>
	<pre class="brush: csharp">
	new InventoryItem()
		.Created(inventoryItemCreated)
		.PriceUpdated(inventoryItemPriceUpdated)
		.Deactivated(inventoryItemDeactivated);
	</pre>
</code>
<p>
	I would apply a simple refactoring here and given that the context of the method call is given in the event then we can call the methods 
	<strong>Apply</strong>:
</p>
<code>
	<pre class="brush: csharp">
	new InventoryItem()
		.Apply(inventoryItemCreated)
		.Apply(inventoryItemPriceUpdated)
		.Apply(inventoryItemDeactivated)
	</pre>
</code>
<p>
	So, what if we each function returns a current state of the <strong>InventoryItem</strong> then we can remove the need
	for the objects and we can, in a functional language, simply chain calls together to get to the current state of the item:
</p>
<code>
	<pre class="brush: csharp">
	Apply(
		Apply(
			Apply(inventoryItemCreated),
			,inventoryItemPriceUpdated),
		inventoryItemDeactivated);
	</pre>
</code>
<p>
	So, I've be focussed on re-hydration of the current state from <strong>Events</strong> but now what happens when 
	we issue a command? Greg explained that these methods would return the event to represent the state change...
</p>
<code>
	<pre class="brush: csharp">
	evt = Reactivate(
			Apply(
				Apply(
					Apply(inventoryItemCreated), 
					inventoryItemPriceUpdated), 
				inventoryItemDeactivated))
	currentState = Apply(
				Apply(
					Apply(
						Apply(inventoryItemCreated), 
						inventoryItemPriceUpdated), 
					inventoryItemDeactivated), 
				evt)
	</pre>
</code>
<h3>
	Conclusion
</h3>
<p>
	Greg has a habit of killing my illusions, and I don't think that it is just me who takes a look at his work and thinks "hey, is it
	really that simple?" but I think he just looks at the problems from a different perspective. There are things that I have yet to
	be convinced about in terms of functional <em>DDD</em>:
</p>
<ul>
	<li>
		Cohesion: one thing the object model gives you is strong cohesion of the functions, even if we are doing the 
		<em>immutable</em> domain object then all of the state change methods are bound together in the object
		and can be hidden inside the object from the outside world, I could envisage a 
		<strong>BuildFromHistory(IEnumerable&lt;Event&gt; history)</strong> method on the object that will
		return it's immutable state.
	</li>
	<li>
		Where is the model that we are working on? Where is the <em>ubiquitous language</em>?
		I can see that we can still model the verbs as methods, as event representations, but where do the nouns fit
		into this? Do we lose the nouns now?
	</li>
</ul>
	
	
	
					
					<p class="post_categories"> Tags: 
						
						<a href="/tags.html#"></a>
						
						<a href="/tags.html#"></a>
						
						<a href="/tags.html#"></a>
						
					</p>
					
				</div>
				
					<div id="disqus_thread"></div>
					<script type="text/javascript">
					    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
					    var disqus_shortname = 'ninjaferretblog'; // required: replace example with your forum shortname

					    // The following are highly recommended additional parameters. Remove the slashes in front to use.
					    //var disqus_identifier = 'unique_dynamic_id_1234';
					    //var disqus_url = 'http://example.com/permalink-to-page.html';

					    /* * * DON'T EDIT BELOW THIS LINE * * */
					    (function() {
					        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
					        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
					        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
					    })();
					</script>
					<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
					<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
				
			</div>
		</div>
	<div id="footer">
	 	&copy; Copyright 2010 Ian Johnson. All rights reserved. 
	</div>
</body>
<script src="/assets/scripts/rendertweets.js" type="text/javascript"></script>
<script src="http://twitter.com/statuses/user_timeline/ijohnson_tnf.json?callback=twitterCallback2&count=5" type="text/javascript"></script>
<script src="/assets/scripts/syntaxhighlighter/shCore.js" type="text/javascript"></script>
<script src="/assets/scripts/syntaxhighlighter/shBrushCSharp.js" type="text/javascript"></script>
<script src="/assets/scripts/syntaxhighlighter/shBrushXml.js" type="text/javascript"></script>
<script src="/assets/scripts/syntaxhighlighter/shBrushJScript.js" type="text/javascript"></script>
<script src="/assets/scripts/syntaxhighlighter/shBrushPlain.js" type="text/javascript"></script>
<script type="text/javascript">
   SyntaxHighlighter.all(); 
</script>
<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19283283-1']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
</html>